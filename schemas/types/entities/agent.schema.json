{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.memogarden.net/entities/agent.schema.json",
  "title": "Agent",
  "description": "AI agent in the system. Lives in System scope for introspection. Subagents have parent_agent field set.",
  "allOf": [
    {
      "$ref": "entity.schema.json"
    },
    {
      "type": "object",
      "properties": {
        "_type": {
          "const": "Agent"
        },
        "name": {
          "type": "string",
          "description": "Agent display name (mutable)"
        },
        "parent_operator": {
          "type": "string",
          "pattern": "^core_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
          "description": "Which operator owns this agent (immutable - use x-immutable annotation)",
          "x-immutable": true
        },
        "parent_agent": {
          "type": ["string", "null"],
          "pattern": "^core_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
          "description": "Parent agent UUID if this is a subagent (null for top-level agents)"
        },
        "config": {
          "type": "object",
          "description": "Agent configuration (mutable)",
          "properties": {
            "model": {
              "type": "string",
              "description": "LLM model identifier"
            },
            "temperature": {
              "type": "number",
              "minimum": 0,
              "maximum": 2
            },
            "max_tokens": {
              "type": "integer",
              "minimum": 1
            }
          }
        },
        "capabilities": {
          "type": "object",
          "description": "Agent capabilities and permissions (mutable)",
          "properties": {
            "allowed_tools": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Tool names this agent can use"
            },
            "allowed_scopes": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Scope UUIDs this agent can access"
            }
          }
        },
        "delegation_scope": {
          "type": ["object", "null"],
          "description": "For subagents: what subset of capabilities delegated from parent",
          "properties": {
            "allowed_tools": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "allowed_scopes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "prompt_artifact": {
          "type": ["string", "null"],
          "pattern": "^core_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
          "description": "Reference to Artifact entity containing agent's system prompt"
        }
      },
      "required": ["name", "parent_operator"]
    }
  ]
}
